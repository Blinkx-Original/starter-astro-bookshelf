---
import Layout from "../layouts/Layout.astro";
import { getAllBooks } from "../lib/contentful";

// Trae libros desde Contentful durante el build.
// Si hay error o no existe la colecciÃ³n, la funciÃ³n devuelve [].
const books = await getAllBooks();
---

<Layout title="Astrobrary">
  <h1 class="text-6xl sm:text-8xl text-center">Astrobrary ðŸš€</h1>
  <h2 class="text-base text-center text-stone-400">Collection of Astrology Science Fiction</h2>

  {books.length === 0 ? (
    <section class="container mx-auto mt-8">
      <p class="text-center">
        No hay items publicados aÃºn o el content type no coincide.<br />
        Crea al menos 1 entrada de <code>Book Reference Page</code> (API ID
        <code>bookReferencePage</code>) en el environment <code>master</code> y vuelve a desplegar.
      </p>
    </section>
  ) : (
    <section class="container mx-auto mt-6">
      <ul class="grid grid-cols-1 gap-x-6 gap-y-10 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 xl:gap-x-8">
        {books.map((book) => (
          <li class="mt-4">
            <a href={`/books/${book.sys.id}`} class="group">
              <div class="aspect-[4/5] w-full overflow-hidden rounded-lg bg-gray-200">
                <img
                  src={book.coverImage?.url}
                  alt={book.title}
                  class="h-full w-full object-cover object-center group-hover:opacity-75"
                  loading="lazy"
                />
              </div>
              <h3 class="mt-2 text-sm font-medium">{book.title}</h3>
            </a>
          </li>
        ))}
      </ul>
    </section>
  )}
</Layout>
